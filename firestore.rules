
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description
     *   Products are public and can be read by anyone. For this prototype,
     *   writes are also public to allow the app to function without a
     *   full admin implementation.
     * @path
     *   /products/{productId}
     */
    match /products/{productId} {
      allow get: if true;
      allow list: if true;

      // WARNING: These rules are insecure for production.
      // Any user can write to the products collection.
      // This should be locked down to admin users in a real application.
      allow create: if true;
      allow update: if true;
      allow delete: if false; // Deleting products is not a feature yet.
    }

    /**
     * @description
     *   Orders are private documents. Authenticated users can create orders
     *   for themselves. Listing orders is restricted to signed-in users
     *   (acting as admins for this prototype).
     * @path
     *   /orders/{orderId}
     */
    match /orders/{orderId} {
      // Deny direct client reads of single orders to protect customer privacy.
      allow get: if false;

      // Allow signed-in users (admins) to list all orders for the dashboard.
      allow list: if isSignedIn();

      // An authenticated user can create an order for themselves.
      // The `userId` in the new document must match the creator's UID.
      allow create: if isSignedIn() && request.resource.data.userId == request.auth.uid;

      // Updating and deleting orders is disabled for clients. This should be an admin task.
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description
     *  Content for the landing page. Publicly readable, but only writable by admins.
     * @path
     *  /landingPage/{pageId}
     */
    match /landingPage/{pageId} {
      allow get: if true;
      allow list: if true;
      allow create, update: if isSignedIn();
      allow delete: if false;
    }

    /**
     * @description
     *  Vouchers for discounts. Can only be managed by admins.
     * @path
     *  /vouchers/{voucherId}
     */
    match /vouchers/{voucherId} {
      allow read, list, create, update: if isSignedIn();
      allow delete: if false;
    }
  }
}
